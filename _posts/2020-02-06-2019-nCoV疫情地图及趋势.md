---
layout:     post
title:      2019-nCoV疫情地图及趋势
subtitle:   "新型冠状病毒疫情热图及数据分析"
date:       2020-02-06
author:     汤泡饭
header-img: img/post-bg-globe.jpg
music-id: 1412142634
catalog: true
tags:
    - Python
---
>2020/05/06更新说明：适配各终端页面自适应特性。（前端好难。


>Start of Spring, the first solar term of the year begins. Hopefully the winter of epidemic should reach an end in the near future.

最近发现百度、腾讯等各大平台都发布了肺炎疫情实时动态的数据可视化H5页面，其中就包括了疫情热图、发展趋势折线图等。

寒假正好在看Python，用Python借助第三方库来进行数据处理及可视化非常方便和美观。

查阅了几篇资料后，采用Python获取网页后台疫情数据 + `pyecharts`库进行数据可视化来实现。代码请接着往下看。

每编译一次py文件，会发布一个由最新疫情数据绘制的html页面。

由于Github+Jekyll搭建的博客仅支持静态页面，暂无法实现html页面数据的自动刷新。只能***人工定时编译py文件***后上传html页面至服务器。

html页面内绘制了**全国总量**、**昨日新增饼图**，**中国疫情**、**世界疫情地图**，**每日新增趋势柱状图**，**确诊与疑似**、**治愈与死亡趋势折线图**。

数据来源：[腾讯疫情实时追踪](https://news.qq.com/zt2020/page/feiyan.htm?from=timeline&isappinstalled=0)

<html>
<head>
    <meta charset="UTF-8">
    <title>Awesome-pyecharts</title>
            <script type="text/javascript" src="https://assets.pyecharts.org/assets/echarts.min.js"></script>
        <script type="text/javascript" src="https://assets.pyecharts.org/assets/maps/china.js"></script>
        <script type="text/javascript" src="https://assets.pyecharts.org/assets/maps/world.js"></script>
        <script type="text/javascript" src="https://assets.pyecharts.org/assets/themes/westeros.js"></script>

    
</head>

<body>
    <div id="1" style="width: 500px;height:350px;"></div>
    <script type="text/javascript">
    var container1 = document.getElementById('1');
    var sizecontainer1 = function () {
        if (window.innerWidth>500) {
            container1.style.width = window.innerWidth*0.75*+'px';
            container1.style.height = window.innerHeight*0.75*+'px';
        } else {
            container1.style.width = window.innerWidth+'px';
            container1.style.height = window.innerHeight+'px';
        }    
};

//设置容器高宽
    sizecontainer1();
    var chart1 = echarts.init(
            container1, 'westeros', {renderer: 'canvas'});

    var option_1 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "confirm",
                    "value": 28083
                },
                {
                    "name": "suspect",
                    "value": 24702
                },
                {
                    "name": "dead",
                    "value": 564
                },
                {
                    "name": "heal",
                    "value": 1237
                }
            ],
            "radius": [
                50,
                80
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "confirm",
                "suspect",
                "dead",
                "heal"
            ],
            "selected": {},
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {
            "text": "\u5168\u56fd\u603b\u91cf",
            "subtext": "\u622a\u6b622020-02-06 15:40:40",
            "padding": 5,
            "itemGap": 10
        }
    ]
};
        chart1.setOption(option_1);
        window.onresize = function () {
            sizecontainer1();
            chart1.resize();
    }
    </script>
<br/>  


<div id="2" style="width: 500px;height:350px;"></div>
<script type="text/javascript">
var container2 = document.getElementById('2');
var sizecontainer2 = function () {
    if (window.innerWidth>500) {
            container2.style.width = window.innerWidth*0.75*+'px';
            container2.style.height = window.innerHeight*0.75*+'px';
        } else {
            container2.style.width = window.innerWidth+'px';
            container2.style.height = window.innerHeight+'px';
        }  
};

//设置容器高宽
sizecontainer2();
var chart2 = echarts.init(
        container2, 'westeros', {renderer: 'canvas'});

var option_2 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "series": [
        {
            "type": "pie",
            "clockwise": true,
            "data": [
                {
                    "name": "confirm",
                    "value": 3720
                },
                {
                    "name": "suspect",
                    "value": 1442
                },
                {
                    "name": "dead",
                    "value": 73
                },
                {
                    "name": "heal",
                    "value": 345
                }
            ],
            "radius": [
                50,
                80
            ],
            "center": [
                "50%",
                "50%"
            ],
            "label": {
                "show": true,
                "position": "top",
                "margin": 8,
                "formatter": "{c}"
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "confirm",
                "suspect",
                "dead",
                "heal"
            ],
            "selected": {},
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {
            "text": "\u6628\u65e5\u65b0\u589e",
            "subtext": "\u622a\u6b622020-02-06 15:40:40",
            "padding": 5,
            "itemGap": 10
        }
    ]
};
    chart2.setOption(option_2);
    window.onresize = function () {
        sizecontainer2();
        chart2.resize();
}
</script>
<br/>  


<div id="3" style="width: 700px;height:500px;"></div>
<script type="text/javascript">
var container3 = document.getElementById('3');
var sizecontainer3 = function () {
    if (window.innerWidth>500) {
            container3.style.width = window.innerWidth*0.18*+'px';
            container3.style.height = window.innerHeight*0.18*+'px';
        } else {
            container3.style.width = window.innerWidth+'px';
            container3.style.height = window.innerHeight+'px';
        }  
};

//设置容器高宽
sizecontainer3();
var chart3 = echarts.init(
        container3, 'westeros', {renderer: 'canvas'});

var option_3 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "series": [
        {
            "type": "map",
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "mapType": "china",
            "data": [
                {
                    "name": "\u4e0a\u6d77",
                    "value": 257
                },
                {
                    "name": "\u4e91\u5357",
                    "value": 128
                },
                {
                    "name": "\u5185\u8499\u53e4",
                    "value": 46
                },
                {
                    "name": "\u5317\u4eac",
                    "value": 274
                },
                {
                    "name": "\u53f0\u6e7e",
                    "value": 13
                },
                {
                    "name": "\u5409\u6797",
                    "value": 59
                },
                {
                    "name": "\u56db\u5ddd",
                    "value": 321
                },
                {
                    "name": "\u5929\u6d25",
                    "value": 78
                },
                {
                    "name": "\u5b81\u590f",
                    "value": 40
                },
                {
                    "name": "\u5b89\u5fbd",
                    "value": 591
                },
                {
                    "name": "\u5c71\u4e1c",
                    "value": 347
                },
                {
                    "name": "\u5c71\u897f",
                    "value": 90
                },
                {
                    "name": "\u5e7f\u4e1c",
                    "value": 944
                },
                {
                    "name": "\u5e7f\u897f",
                    "value": 168
                },
                {
                    "name": "\u65b0\u7586",
                    "value": 36
                },
                {
                    "name": "\u6c5f\u82cf",
                    "value": 373
                },
                {
                    "name": "\u6c5f\u897f",
                    "value": 600
                },
                {
                    "name": "\u6cb3\u5317",
                    "value": 157
                },
                {
                    "name": "\u6cb3\u5357",
                    "value": 851
                },
                {
                    "name": "\u6d59\u6c5f",
                    "value": 954
                },
                {
                    "name": "\u6d77\u5357",
                    "value": 106
                },
                {
                    "name": "\u6e56\u5317",
                    "value": 19665
                },
                {
                    "name": "\u6e56\u5357",
                    "value": 711
                },
                {
                    "name": "\u6fb3\u95e8",
                    "value": 10
                },
                {
                    "name": "\u7518\u8083",
                    "value": 62
                },
                {
                    "name": "\u798f\u5efa",
                    "value": 215
                },
                {
                    "name": "\u897f\u85cf",
                    "value": 1
                },
                {
                    "name": "\u8d35\u5dde",
                    "value": 69
                },
                {
                    "name": "\u8fbd\u5b81",
                    "value": 89
                },
                {
                    "name": "\u91cd\u5e86",
                    "value": 389
                },
                {
                    "name": "\u9655\u897f",
                    "value": 173
                },
                {
                    "name": "\u9752\u6d77",
                    "value": 18
                },
                {
                    "name": "\u9999\u6e2f",
                    "value": 21
                },
                {
                    "name": "\u9ed1\u9f99\u6c5f",
                    "value": 227
                }
            ],
            "roam": true,
            "zoom": 1,
            "showLegendSymbol": false,
            "emphasis": {}
        }
    ],
    "legend": [
        {
            "data": [
                ""
            ],
            "selected": {
                "": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {
            "text": "2019-nCoV \u4e2d\u56fd\u75ab\u60c5\u5730\u56fe",
            "subtext": "\u622a\u6b622020-02-06 15:40:40",
            "padding": 5,
            "itemGap": 10
        }
    ],
    "visualMap": {
        "show": true,
        "type": "piecewise",
        "min": 0,
        "max": 100,
        "inRange": {
            "color": [
                "#50a3ba",
                "#eac763",
                "#d94e5d"
            ]
        },
        "calculable": true,
        "inverse": false,
        "splitNumber": 5,
        "orient": "vertical",
        "showLabel": true,
        "itemWidth": 20,
        "itemHeight": 14,
        "borderWidth": 0,
        "pieces": [
            {
                "min": 1001,
                "label": ">1000",
                "color": "#9C0A0D"
            },
            {
                "min": 500,
                "max": 1000,
                "label": "500-1000",
                "color": "#E64B47"
            },
            {
                "min": 101,
                "max": 499,
                "label": "101-499",
                "color": "#FE8664"
            },
            {
                "min": 10,
                "max": 100,
                "label": "10-100",
                "color": "#FFD2A0"
            },
            {
                "min": 0,
                "max": 9,
                "label": "0-9",
                "color": "#FFEFD7"
            }
        ]
    }
};
    chart3.setOption(option_3);
    window.onresize = function () {
        sizecontainer3();
        chart3.resize();
}
</script>
<br/>  


<div id="4" style="width: 700px;height:500px;"></div>
<script type="text/javascript">
var container4 = document.getElementById('4');
var sizecontainer4 = function () {
    if (window.innerWidth>500) {
            container4.style.width = window.innerWidth*0.18*+'px';
            container4.style.height = window.innerHeight*0.18*+'px';
        } else {
            container4.style.width = window.innerWidth+'px';
            container4.style.height = window.innerHeight+'px';
        }  
};

//设置容器高宽
sizecontainer4();
var chart4 = echarts.init(
        container4, 'westeros', {renderer: 'canvas'});

var option_4 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "series": [
        {
            "type": "map",
            "label": {
                "show": false,
                "position": "top",
                "margin": 8
            },
            "mapType": "world",
            "data": [
                {
                    "name": "China",
                    "value": 28083
                },
                {
                    "name": "Japan",
                    "value": 45
                },
                {
                    "name": "Singapore",
                    "value": 28
                },
                {
                    "name": "Thailand",
                    "value": 25
                },
                {
                    "name": "Korea(republic of)",
                    "value": 23
                },
                {
                    "name": "Australia",
                    "value": 14
                },
                {
                    "name": "U.S.A",
                    "value": 12
                },
                {
                    "name": "Malaysia",
                    "value": 12
                },
                {
                    "name": "Germany",
                    "value": 12
                },
                {
                    "name": "Vietnam",
                    "value": 10
                },
                {
                    "name": "France",
                    "value": 6
                },
                {
                    "name": "Canada",
                    "value": 5
                },
                {
                    "name": "Philippines",
                    "value": 3
                },
                {
                    "name": "India",
                    "value": 3
                },
                {
                    "name": "Italy",
                    "value": 2
                },
                {
                    "name": "United Kingdom",
                    "value": 2
                },
                {
                    "name": "Russia",
                    "value": 2
                },
                {
                    "name": "Nepal",
                    "value": 1
                },
                {
                    "name": "Sri Lanka",
                    "value": 1
                },
                {
                    "name": "Finland",
                    "value": 1
                },
                {
                    "name": "Sweden",
                    "value": 1
                },
                {
                    "name": "Belgium",
                    "value": 1
                },
                {
                    "name": "Spain",
                    "value": 1
                }
            ],
            "roam": true,
            "zoom": 1,
            "showLegendSymbol": false,
            "emphasis": {},
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                ""
            ],
            "selected": {
                "": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "title": [
        {
            "text": "2019-nCoV \u4e16\u754c\u75ab\u60c5\u5730\u56fe",
            "subtext": "\u622a\u6b622020-02-06 15:40:40",
            "padding": 5,
            "itemGap": 10
        }
    ],
    "visualMap": {
        "show": true,
        "type": "piecewise",
        "min": 0,
        "max": 100,
        "inRange": {
            "color": [
                "#50a3ba",
                "#eac763",
                "#d94e5d"
            ]
        },
        "calculable": true,
        "inverse": false,
        "splitNumber": 5,
        "orient": "vertical",
        "showLabel": true,
        "itemWidth": 20,
        "itemHeight": 14,
        "borderWidth": 0,
        "pieces": [
            {
                "min": 101,
                "label": ">100"
            },
            {
                "min": 10,
                "max": 100,
                "label": "10-100"
            },
            {
                "min": 0,
                "max": 9,
                "label": "0-9"
            }
        ]
    }
};
    chart4.setOption(option_4);
    window.onresize = function () {
        sizecontainer4();
        chart4.resize();
}
</script>
<br/> 


<div id="5" style="width: 700px;height:400px;"></div>
<script type="text/javascript">
var container5 = document.getElementById('5');
var sizecontainer5 = function () {
    if (window.innerWidth>500) {
            container5.style.width = window.innerWidth*0.18*+'px';
            container5.style.height = window.innerHeight*0.18*+'px';
        } else {
            container5.style.width = window.innerWidth+'px';
            container5.style.height = window.innerHeight+'px';
        }  
};

//设置容器高宽
sizecontainer5();
var chart5 = echarts.init(
        container5, 'westeros', {renderer: 'canvas'});

var option_5 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "series": [
        {
            "type": "bar",
            "name": "\u786e\u8bca",
            "data": [
                "77",
                "149",
                "131",
                "259",
                "444",
                "688",
                "769",
                "1771",
                "1459",
                "1737",
                "1982",
                "2102",
                "2590",
                "2829",
                "3235",
                "3893",
                "3697"
            ],
            "barCategoryGap": "20%",
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            }
        },
        {
            "type": "bar",
            "name": "\u7591\u4f3c",
            "data": [
                "27",
                "53",
                "257",
                "680",
                "1118",
                "1309",
                "3806",
                "2077",
                "3248",
                "4148",
                "4812",
                "5019",
                "4562",
                "5173",
                "5072",
                "3971",
                "5328"
            ],
            "barCategoryGap": "20%",
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            }
        },
        {
            "type": "bar",
            "name": "\u6b7b\u4ea1",
            "data": [
                "0",
                "3",
                "8",
                "8",
                "16",
                "15",
                "24",
                "26",
                "26",
                "38",
                "43",
                "46",
                "45",
                "57",
                "64",
                "65",
                "73"
            ],
            "barCategoryGap": "20%",
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            }
        },
        {
            "type": "bar",
            "name": "\u6cbb\u6108",
            "data": [
                "0",
                "0",
                "0",
                "6",
                "3",
                "11",
                "2",
                "9",
                "43",
                "21",
                "47",
                "72",
                "85",
                "147",
                "157",
                "262",
                "261"
            ],
            "barCategoryGap": "20%",
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u786e\u8bca",
                "\u7591\u4f3c",
                "\u6b7b\u4ea1",
                "\u6cbb\u6108"
            ],
            "selected": {
                "\u786e\u8bca": true,
                "\u7591\u4f3c": true,
                "\u6b7b\u4ea1": true,
                "\u6cbb\u6108": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "01.20",
                "01.21",
                "01.22",
                "01.23",
                "01.24",
                "01.25",
                "01.26",
                "01.27",
                "01.28",
                "01.29",
                "01.30",
                "01.31",
                "02.01",
                "02.02",
                "02.03",
                "02.04",
                "02.05"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u6bcf\u65e5\u65b0\u589e\u6570\u636e\u8d8b\u52bf",
            "subtext": "\u622a\u6b622020-02-06 15:40:40",
            "padding": 5,
            "itemGap": 10
        }
    ]
};
    chart5.setOption(option_5);
    window.onresize = function () {
        sizecontainer5();
        chart5.resize();
}
</script>
<br/>  


<div id="6" style="width: 700px;height:400px;"></div>
<script type="text/javascript">
var container6 = document.getElementById('6');
var sizecontainer6 = function () {
     if (window.innerWidth>500) {
            container6.style.width = window.innerWidth*0.18*+'px';
            container6.style.height = window.innerHeight*0.18*+'px';
        } else {
            container6.style.width = window.innerWidth+'px';
            container6.style.height = window.innerHeight+'px';
        }  
};

//设置容器高宽
sizecontainer6();
var chart6 = echarts.init(
        container6, 'westeros', {renderer: 'canvas'});

var option_6 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "series": [
        {
            "type": "line",
            "name": "\u786e\u8bca",
            "connectNulls": false,
            "symbolSize": 4,
            "showSymbol": true,
            "smooth": false,
            "step": false,
            "data": [
                [
                    "01.13",
                    "41"
                ],
                [
                    "01.14",
                    "41"
                ],
                [
                    "01.15",
                    "41"
                ],
                [
                    "01.16",
                    "45"
                ],
                [
                    "01.17",
                    "62"
                ],
                [
                    "01.18",
                    "198"
                ],
                [
                    "01.19",
                    "275"
                ],
                [
                    "01.20",
                    "291"
                ],
                [
                    "01.21",
                    "440"
                ],
                [
                    "01.22",
                    "571"
                ],
                [
                    "01.23",
                    "830"
                ],
                [
                    "01.24",
                    "1287"
                ],
                [
                    "01.25",
                    "1975"
                ],
                [
                    "01.26",
                    "2744"
                ],
                [
                    "01.27",
                    "4515"
                ],
                [
                    "01.28",
                    "5974"
                ],
                [
                    "01.29",
                    "7711"
                ],
                [
                    "01.30",
                    "9692"
                ],
                [
                    "01.31",
                    "11791"
                ],
                [
                    "02.01",
                    "14380"
                ],
                [
                    "02.02",
                    "17236"
                ],
                [
                    "02.03",
                    "20471"
                ],
                [
                    "02.04",
                    "24363"
                ],
                [
                    "02.05",
                    "28060"
                ]
            ],
            "hoverAnimation": true,
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "lineStyle": {
                "width": 1,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            },
            "zlevel": 0,
            "z": 0
        },
        {
            "type": "line",
            "name": "\u7591\u4f3c",
            "connectNulls": false,
            "symbolSize": 4,
            "showSymbol": true,
            "smooth": false,
            "step": false,
            "data": [
                [
                    "01.13",
                    "0"
                ],
                [
                    "01.14",
                    "0"
                ],
                [
                    "01.15",
                    "0"
                ],
                [
                    "01.16",
                    "0"
                ],
                [
                    "01.17",
                    "0"
                ],
                [
                    "01.18",
                    "0"
                ],
                [
                    "01.19",
                    "0"
                ],
                [
                    "01.20",
                    "54"
                ],
                [
                    "01.21",
                    "37"
                ],
                [
                    "01.22",
                    "393"
                ],
                [
                    "01.23",
                    "1072"
                ],
                [
                    "01.24",
                    "1965"
                ],
                [
                    "01.25",
                    "2684"
                ],
                [
                    "01.26",
                    " 5794"
                ],
                [
                    "01.27",
                    "6973"
                ],
                [
                    "01.28",
                    "9239"
                ],
                [
                    "01.29",
                    "12167"
                ],
                [
                    "01.30",
                    "15238"
                ],
                [
                    "01.31",
                    "17988"
                ],
                [
                    "02.01",
                    "19544"
                ],
                [
                    "02.02",
                    "21558"
                ],
                [
                    "02.03",
                    "23214"
                ],
                [
                    "02.04",
                    "23260"
                ],
                [
                    "02.05",
                    "24702"
                ]
            ],
            "hoverAnimation": true,
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "lineStyle": {
                "width": 1,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            },
            "zlevel": 0,
            "z": 0
        }
    ],
    "legend": [
        {
            "data": [
                "\u786e\u8bca",
                "\u7591\u4f3c"
            ],
            "selected": {
                "\u786e\u8bca": true,
                "\u7591\u4f3c": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "01.13",
                "01.14",
                "01.15",
                "01.16",
                "01.17",
                "01.18",
                "01.19",
                "01.20",
                "01.21",
                "01.22",
                "01.23",
                "01.24",
                "01.25",
                "01.26",
                "01.27",
                "01.28",
                "01.29",
                "01.30",
                "01.31",
                "02.01",
                "02.02",
                "02.03",
                "02.04",
                "02.05"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u786e\u8bca\u4e0e\u7591\u4f3c\u8d8b\u52bf",
            "subtext": "\u622a\u6b622020-02-06 15:40:40",
            "padding": 5,
            "itemGap": 10
        }
    ]
};
    chart6.setOption(option_6);
    window.onresize = function () {
        sizecontainer6();
        chart6.resize();
}
</script>
<br/>


<div id="7" style="width: 700px;height:500px;"></div>
<script type="text/javascript">
var container7 = document.getElementById('7');
var sizecontainer7 = function () {
     if (window.innerWidth>500) {
            container7.style.width = window.innerWidth*0.18*+'px';
            container7.style.height = window.innerHeight*0.18*+'px';
        } else {
            container7.style.width = window.innerWidth+'px';
            container7.style.height = window.innerHeight+'px';
        }  
};

//设置容器高宽
sizecontainer7();
var chart7 = echarts.init(
        container7, 'westeros', {renderer: 'canvas'});

var option_7 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "series": [
        {
            "type": "line",
            "name": "\u6cbb\u6108",
            "connectNulls": false,
            "symbolSize": 4,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "01.13",
                    "0"
                ],
                [
                    "01.14",
                    "0"
                ],
                [
                    "01.15",
                    "5"
                ],
                [
                    "01.16",
                    "8"
                ],
                [
                    "01.17",
                    "12"
                ],
                [
                    "01.18",
                    "17"
                ],
                [
                    "01.19",
                    "18"
                ],
                [
                    "01.20",
                    "25"
                ],
                [
                    "01.21",
                    "25"
                ],
                [
                    "01.22",
                    "25"
                ],
                [
                    "01.23",
                    "34"
                ],
                [
                    "01.24",
                    "38"
                ],
                [
                    "01.25",
                    "49"
                ],
                [
                    "01.26",
                    "51"
                ],
                [
                    "01.27",
                    "60"
                ],
                [
                    "01.28",
                    "103"
                ],
                [
                    "01.29",
                    "124"
                ],
                [
                    "01.30",
                    "171"
                ],
                [
                    "01.31",
                    "243"
                ],
                [
                    "02.01",
                    "328"
                ],
                [
                    "02.02",
                    "475"
                ],
                [
                    "02.03",
                    "632"
                ],
                [
                    "02.04",
                    "892"
                ],
                [
                    "02.05",
                    "1153"
                ]
            ],
            "hoverAnimation": true,
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "lineStyle": {
                "width": 1,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            },
            "zlevel": 0,
            "z": 0
        },
        {
            "type": "line",
            "name": "\u6b7b\u4ea1",
            "connectNulls": false,
            "symbolSize": 4,
            "showSymbol": true,
            "smooth": true,
            "step": false,
            "data": [
                [
                    "01.13",
                    "1"
                ],
                [
                    "01.14",
                    "1"
                ],
                [
                    "01.15",
                    "2"
                ],
                [
                    "01.16",
                    "2"
                ],
                [
                    "01.17",
                    "2"
                ],
                [
                    "01.18",
                    "3"
                ],
                [
                    "01.19",
                    "4"
                ],
                [
                    "01.20",
                    "6"
                ],
                [
                    "01.21",
                    "9"
                ],
                [
                    "01.22",
                    "17"
                ],
                [
                    "01.23",
                    "25"
                ],
                [
                    "01.24",
                    "41"
                ],
                [
                    "01.25",
                    "56"
                ],
                [
                    "01.26",
                    "80"
                ],
                [
                    "01.27",
                    "106"
                ],
                [
                    "01.28",
                    "132"
                ],
                [
                    "01.29",
                    "170"
                ],
                [
                    "01.30",
                    "213"
                ],
                [
                    "01.31",
                    "259"
                ],
                [
                    "02.01",
                    "304"
                ],
                [
                    "02.02",
                    "361"
                ],
                [
                    "02.03",
                    "425"
                ],
                [
                    "02.04",
                    "491"
                ],
                [
                    "02.05",
                    "564"
                ]
            ],
            "hoverAnimation": true,
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "lineStyle": {
                "width": 1,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            },
            "zlevel": 0,
            "z": 0
        }
    ],
    "legend": [
        {
            "data": [
                "\u6cbb\u6108",
                "\u6b7b\u4ea1"
            ],
            "selected": {
                "\u6cbb\u6108": true,
                "\u6b7b\u4ea1": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "01.13",
                "01.14",
                "01.15",
                "01.16",
                "01.17",
                "01.18",
                "01.19",
                "01.20",
                "01.21",
                "01.22",
                "01.23",
                "01.24",
                "01.25",
                "01.26",
                "01.27",
                "01.28",
                "01.29",
                "01.30",
                "01.31",
                "02.01",
                "02.02",
                "02.03",
                "02.04",
                "02.05"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "text": "\u6cbb\u6108\u4e0e\u6b7b\u4ea1\u8d8b\u52bf",
            "subtext": "\u622a\u6b622020-02-06 15:40:40",
            "padding": 5,
            "itemGap": 10
        }
    ]
};
    chart7.setOption(option_7);
    window.onresize = function () {
        sizecontainer7();
        chart7.resize();
}
</script>
<script>
window.addEventListener("resize", function(){
    sizecontainer1();
    chart1.resize();
    sizecontainer2();
    chart2.resize();
    sizecontainer3();
    chart3.resize();
    sizecontainer4();
    chart4.resize();
    sizecontainer5();
    chart5.resize();
    sizecontainer6();
    chart6.resize();
    sizecontainer7();
    chart7.resize();
})
</script>
</body>
</html>

## 一、网页分析
首先进入数据源网站[腾讯疫情实时追踪](https://news.qq.com/zt2020/page/feiyan.htm?from=timeline&isappinstalled=0)，按F12进入开发者工具并**刷新**（以Chrome浏览器为例），点击`Network`。
[![16CkZQ.md.jpg](https://s2.ax1x.com/2020/02/06/16CkZQ.md.jpg)](https://imgchr.com/i/16CkZQ)
分析请求头：
[![16Ciqg.jpg](https://s2.ax1x.com/2020/02/06/16Ciqg.jpg)](https://imgchr.com/i/16Ciqg)
- `name=disease_h5` 是数据位置
- `callback=jQuery34109938576041762315_1580970784178_: 1580970784179` 返回当前时间戳的一个函数。所以我们请求数据的URL为：[https://view.inews.qq.com/g2/getOnsInfoname=disease_h5](https://view.inews.qq.com/g2/getOnsInfoname=disease_h5)

## 二、数据整理
### 导入第三方库

```
import time
import json
import requests
from datetime import datetime
import pandas as pd
import numpy as np
```

昨天我在Mac上配Python环境、安装第三方库时折腾了大半天。如果你是通过Pycharm的Project Interpreter配置界面进行的第三方库安装，***请注意以下几个坑点***：
- 请在`Manage Repositories`中的镜像更换为**国内镜像**。（梯子倒了的我用起来非常难受）
- 在安装其他库之前，先把**pip升级**，点击`Install Package`前勾选右边的`Specify version`，否则会安装失败。

第三方库安装完成后重启Pycharm。

### 抓取数据
```
def catch_data():
    url = 'https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5'
    reponse = requests.get(url=url).json()
    # 返回数据字典
    data = json.loads(reponse['data'])
    return data

data = catch_data()
data.keys()
```

### 数据处理
```
# 数据集包括["国内总量","国内新增","更新时间","数据明细","每日数据","每日新增"]

lastUpdateTime = data['lastUpdateTime']
chinaTotal = data['chinaTotal']
chinaAdd = data['chinaAdd']
print(chinaTotal)
print(chinaAdd)
```

#### 国内数据处理第一步
```
# 数据明细
areaTree = data['areaTree']
china_data = areaTree[0]['children']
china_list = []
for a in range(len(china_data)):
    province = china_data[a]['name']
    province_list = china_data[a]['children']
    for b in range(len(province_list)):
        city = province_list[b]['name']
        total = province_list[b]['total']
        today = province_list[b]['today']
        china_dict = {}
        china_dict['province'] = province
        china_dict['city'] = city
        china_dict['total'] = total
        china_dict['today'] = today
        china_list.append(china_dict)

china_data = pd.DataFrame(china_list)
china_data.head()
```

#### 国内数据处理第二步
```
# 定义数据处理函数
def confirm(x):
    confirm = eval(str(x))['confirm']
    return confirm

def suspect(x):
    suspect = eval(str(x))['suspect']
    return suspect

def dead(x):
    dead = eval(str(x))['dead']
    return dead

def heal(x):
    heal = eval(str(x))['heal']
    return heal

# 函数映射
china_data['confirm'] = china_data['total'].map(confirm)
china_data['suspect'] = china_data['total'].map(suspect)
china_data['dead'] = china_data['total'].map(dead)
china_data['heal'] = china_data['total'].map(heal)
china_data['addconfirm'] = china_data['today'].map(confirm)
china_data['addsuspect'] = china_data['today'].map(suspect)
china_data['adddead'] = china_data['today'].map(dead)
china_data['addheal'] = china_data['today'].map(heal)
china_data = china_data[
    ["province", "city", "confirm", "suspect", "dead", "heal", "addconfirm", "addsuspect", "adddead", "addheal"]]
china_data.head()
```

#### 国际数据处理
```
global_data = pd.DataFrame(data['areaTree'])
global_data['confirm'] = global_data['total'].map(confirm)
global_data['suspect'] = global_data['total'].map(suspect)
global_data['dead'] = global_data['total'].map(dead)
global_data['heal'] = global_data['total'].map(heal)
global_data['addconfirm'] = global_data['today'].map(confirm)
global_data['addsuspect'] = global_data['today'].map(suspect)
global_data['adddead'] = global_data['today'].map(dead)
global_data['addheal'] = global_data['today'].map(heal)
world_name = pd.read_excel("世界各国中英文对照.xlsx")
global_data = pd.merge(global_data, world_name, left_on="name", right_on="中文", how="inner")
global_data = global_data[
    ["name", "英文", "confirm", "suspect", "dead", "heal", "addconfirm", "addsuspect", "adddead", "addheal"]]
global_data.head()
```

#### 每日数据处理
```
chinaDayList = pd.DataFrame(data['chinaDayList'])
chinaDayList = chinaDayList[['date', 'confirm', 'suspect', 'dead', 'heal']]
chinaDayList.head()
```

#### 新增数据处理
```
chinaDayAddList = pd.DataFrame(data['chinaDayAddList'])
chinaDayAddList = chinaDayAddList[['date', 'confirm', 'suspect', 'dead', 'heal']]
chinaDayAddList.head()
```

## 三、数据可视化
### 第三方库导入
```
from pyecharts.charts import *
from pyecharts import options as opts 
from pyecharts.globals import ThemeType
# pyecharts的内置图表主题
```
### 饼图绘制
```
total_pie = Pie(init_opts=opts.InitOpts(theme=ThemeType.WESTEROS, width='500px', height='350px'))  # 设置主题，和画布大小
total_pie.add("", [list(z) for z in zip(chinaTotal.keys(), chinaTotal.values())],
              center=["50%", "50%"],  # 图的位置
              radius=[50, 80])  # 内外径大小
total_pie.set_global_opts(
    title_opts=opts.TitleOpts(title="全国总量", subtitle=("截止" + lastUpdateTime)))
total_pie.set_series_opts(label_opts=opts.LabelOpts(formatter="{c}"))  # 标签格式

totaladd_pie = Pie(init_opts=opts.InitOpts(theme=ThemeType.WESTEROS, width='500px', height='350px'))  # 设置主题，和画布大小
totaladd_pie.add("", [list(z) for z in zip(chinaAdd.keys(), chinaAdd.values())],
                 center=["50%", "50%"],
                 radius=[50, 80])
totaladd_pie.set_global_opts(
    title_opts=opts.TitleOpts(title="昨日新增", subtitle=("截止" + lastUpdateTime)))
totaladd_pie.set_series_opts(label_opts=opts.LabelOpts(formatter="{c}"))  # 标签格式
```

### 中国疫情地图热图绘制
```
# 数据处理
area_data = china_data.groupby("province")["confirm"].sum().reset_index()
area_data.columns = ["province", "confirm"]

area_map = Map(init_opts=opts.InitOpts(theme=ThemeType.WESTEROS))
area_map.add("", [list(z) for z in zip(list(area_data["province"]), list(area_data["confirm"]))], "china",
             is_map_symbol_show=False)
area_map.set_global_opts(title_opts=opts.TitleOpts(title="2019-nCoV 中国疫情地图", subtitle=("截止" + lastUpdateTime)),
                         visualmap_opts=opts.VisualMapOpts(is_piecewise=True,
                                                           pieces=[
                                                               {"min": 1001, "label": '>1000', "color": "#9C0A0D"},
                                                               # 不指定 max，表示 max 为无限大
                                                               {"min": 500, "max": 1000, "label": '500-1000',
                                                                "color": "#E64B47"},
                                                               {"min": 101, "max": 499, "label": '101-499',
                                                                "color": "#FE8664"},
                                                               {"min": 10, "max": 100, "label": '10-100',
                                                                "color": "#FFD2A0"},
                                                               {"min": 0, "max": 9, "label": '0-9',
                                                                "color": "#FFEFD7"}]))
```

### 世界疫情地图热图绘制
```
world_map = Map(init_opts=opts.InitOpts(theme=ThemeType.WESTEROS))
world_map.add("", [list(z) for z in zip(list(global_data["英文"]), list(global_data["confirm"]))], "world",
              is_map_symbol_show=False)
world_map.set_global_opts(title_opts=opts.TitleOpts(title="2019-nCoV 世界疫情地图", subtitle=("截止" + lastUpdateTime)),
                          visualmap_opts=opts.VisualMapOpts(is_piecewise=True,
                                                            pieces=[
                                                                {"min": 101, "label": '>100'},  # 不指定 max，表示 max 为无限大
                                                                {"min": 10, "max": 100, "label": '10-100'},
                                                                {"min": 0, "max": 9, "label": '0-9'}]))
world_map.set_series_opts(label_opts=opts.LabelOpts(is_show=False))
```

### 每日新增柱状图绘制
```
bar = Bar(init_opts=opts.InitOpts(theme=ThemeType.WESTEROS, width='900px', height='400px'))
bar.add_xaxis(list(chinaDayAddList["date"]))
bar.add_yaxis("确诊", list(chinaDayAddList["confirm"]))
bar.add_yaxis("疑似", list(chinaDayAddList["suspect"]))
bar.add_yaxis("死亡", list(chinaDayAddList["dead"]))
bar.add_yaxis("治愈", list(chinaDayAddList["heal"]))
bar.set_global_opts(title_opts=opts.TitleOpts(title="每日新增数据趋势", subtitle=("截止" + lastUpdateTime)))
```

### 确诊与疑似折线图绘制
```
line2 = Line(init_opts=opts.InitOpts(theme=ThemeType.WESTEROS))
line2.add_xaxis(list(chinaDayList["date"]))
line2.add_yaxis("确诊", list(chinaDayList["confirm"]))
line2.add_yaxis("疑似", list(chinaDayList["suspect"]))
line2.set_global_opts(title_opts=opts.TitleOpts(title="确诊与疑似趋势", subtitle=("截止" + lastUpdateTime)))
```

### 治愈与死亡折线图绘制
```
line1 = Line(init_opts=opts.InitOpts(theme=ThemeType.WESTEROS))
line1.add_xaxis(list(chinaDayList["date"]))
line1.add_yaxis("治愈", list(chinaDayList["heal"]), is_smooth=True)
line1.add_yaxis("死亡", list(chinaDayList["dead"]), is_smooth=True)
line1.set_global_opts(title_opts=opts.TitleOpts(title="治愈与死亡趋势", subtitle=("截止" + lastUpdateTime)))
```

## 四、图片汇总与html发布
```
page = Page()
page.add(total_pie)
page.add(totaladd_pie)
page.add(area_map)
page.add(world_map)
page.add(bar)
page.add(line2)
page.add(line1)
page.render("2019-nCoV.html")
```

所有源文件已经push到[我的Github仓库](https://github.com/TMYuan627/Test/tree/master/2019-nCoV)，请随意fork or **star**！

学校已经确定24号开不了学了，不想在家上课。。。。。

**天佑中华**。            
